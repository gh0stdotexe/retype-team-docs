# Installing and Running PANIC

This page will guide you through the steps required to get PANIC up and alerting, including the installation of preliminaries, setting up of PANIC itself, additional (optional) configuration, and running the alerter (directly or as a Linux service). Some steps are optional.

We recommend that the alerter is installed on a Linux system, given the simpler installation and running process. However, instructions on how to install PANIC on a Windows system are also provided. On a Debian-based Linux system, run the following before starting the installation process:

```shell
sudo apt-get update && sudo apt-get upgrade -y
```

## Requirements

The only major requirement to run PANIC is Python 3. However, to unlock the full potential of the alerter, we recommend that you install or set up as many of the below requirements as possible:

- Python v3.5.2+ with pip package manager and pipenv packaging tool.
- **Optional**: Telegram account and bots, for Telegram alerts and commands.
- **Optional**: Twilio account, for highly effective phone call alerts.
- **Optional**: Redis server, to keep a backup of the alerter state and to have some control over the alerter, such as to snooze phone call alerts using Telegram commands.

### Python (with pip and pipenv)

1. To install **Python v3.5.2 or greater**, you can [follow this guide](https://realpython.com/installing-python/).
2. To install **pip** package manager:
   - On Linux, run:&#x20;

```shell
sudo apt-get install python3-pip -y
```

To install **pipenv** packaging tool, run:

```shell
sudo -H pip install -U pipenv
```

(If 'pip' is not found, try using 'pip3' instead.)

**At the end, you should be able to:**

1. Get the Python version by running

```shell
python3 --version
```

(You may have to replace 'python' with 'python3.6', 'python3.7', etc.)

```shell
pip --version
```

Get the pipenv version by running

```shell
pipenv --version
```

### Optional Features

- **Telegram**: [Click here](https://github.com/SimplyVC/panic_cosmos/blob/master/doc/INSTALL_TELEGRAM.md) if you want to set up a Telegram account with bots.
- **Twilio**: [Click here](https://github.com/SimplyVC/panic_cosmos/blob/master/doc/INSTALL_TWILIO.md) if you want to set up a Twilio account.
- **Redis server**: [Click here](https://github.com/SimplyVC/panic_cosmos/blob/master/doc/INSTALL_REDIS.md) if you want to set up a Redis server.

## Setting up PANIC

PANIC requires its own setup process, involving three main parts, each of which generates its own respective config file:

- Linking up any of the optional features that you set up (`config/user_config_main.ini`)
- Provide a list of nodes that you wish to monitor (`config/user_config_nodes.ini`)
- Provide a list of GitHub repositories that you wish to monitor (`config/user_config_repos.ini`)

All of these steps are packaged into one setup process which is started up by running:

```shell
cd ~
git clone https://github.com/gh0stdotexe/panic_cosmos.git
cd panic_cosmos
sudo pipenv sync
sudo pipenv run python run_setup.py
```

- Run through the shell prompts to configure node alerting.
- For Telegram alerts, you'll need the API key provided by the bot you create (instructions from shell prompts). When asked for the "Chat ID", that can be found by taking the provided API key, and plugging it into the following URL:

```shell
https://api.telegram.org/bot<APIKEY>/getUpdates
```

- Look through the messages returned and find the "Chat ID". Enter this chat ID into the shell prompt.
- Fill out the remaining prompts. When asked to configure Node alerts, type yes, and then use the following configuration template:

```shell
[node_1]
node_name = Comdex Sentry 1
node_rpc_url = http://185.252.233.250:26657
node_is_validator = false
include_in_node_monitor = true
include_in_network_monitor = true

[node_2]
node_name = Comdex Sentry 2
node_rpc_url = http://185.252.233.251:26657
node_is_validator = false
include_in_node_monitor = true
include_in_network_monitor = true

[node_3]
node_name = Comdex Sentry 3
node_rpc_url = http://185.252.233.252:26657
node_is_validator = false
include_in_node_monitor = true
include_in_network_monitor = true
```

Alternatively, you can take a look at the three `config/example_***.ini` files and perform the config file generation manually by copying the three example config files to the ones listed above and replacing the example pieces of information with actual ones.

The setup process is guided by instructions which we highly recommend that you read. The setup of any optional feature that was not set up in the previous section can be skipped. For convenience, any yes/no question can be answered with a *yes* just by pressing *ENTER*.

Lastly, note that if you wish to change some configurations and run the setup process again, it will detect the config files and will not simply overwrite the current configurations.

## Advanced Configuration

If you had a look in the `config/` folder, you may have seen the `config/internal_config.ini`. There is no setup process for the internal configuration because you do not have to modify it.

The internal configuration file defines values that are less likely to require changing. However, we encourage more advanced users to experiment with different configurations, if the consequences of any changes are realized and acknowledged beforehand.

This file consists of values such as:

- Which files to use for logging and the logging level
- Which Redis databases to use (10 and 11 by default)
- Which Redis keys to use to store values in Redis
- Timeout setting for certain temporary Redis keys
- **Data collection periods for each of the monitor types**
- **Alert frequency and severity modifiers (by time intervals and boundaries)**
- Links to use for the `/validators`, `/block`, and `/tx` Telegram commands.

## Running PANIC

After all of the setting-up, you will be glad to find out that running the alerter is a breeze. To start up PANIC simply run the following commands:

```shell
sudo pipenv sync
sudo pipenv run python run_alerter.py
# If multiple versions of Python are installed, the python executable may be `python3.6`, `python3.7`, etc.
```

Assuming that the setup process was followed till the end, the above commands will start up all of the necessary node, network, and GitHub monitors. These will all start monitoring (and alerting) immediately.

It is recommended to check the console output or general log to make sure that all monitors started-up. Alternatively, you can run the `/status` command on Telegram if you set up both Telegram and Redis.

## Running PANIC as a Linux Service

Running the alerter as a service means that it start up automatically on boot and restarts automatically if it runs into some issue and stops running. To do so, we recommend the following steps:

```shell
# Grant permissions
sudo chown -R whispernode:whispernode /home/whispernode/panic_cosmos
sudo chmod -R 700 /home/whispernode/panic_cosmos/logs
sudo chmod +x /home/whispernode/panic_cosmos/run_setup.py
sudo chmod +x /home/whispernode/panic_cosmos/run_alerter.py

# Install Pipenv Requests
cd /home/whispernode/panic_cosmos/
pipenv install requests
```

The service file will now be created:

```shell
# Create the service file
sudo nano /etc/systemd/system/panic_alerter.service
```

It should contain the following, replacing `<USER>` with the created user's name and the two `<ALERTER_DIR>` with the alerter's installation directory. This assumes that `pipenv` is found under `/usr/local/bin/pipenv` and that the Python executable is `python` (if multiple versions of Python are installed, the `python` executable may be `python3.6`, `python3.7`, etc.). We recommend that you run the command set for ExecStart manually to check that it works before starting the service.

*Make sure that the* *`<ALERTER_DIR>`* *is the full path, for example:* *`/root/panic_cosmos/`*

```shell
[Unit]
Description=PANIC
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=always
User=whispernode
TimeoutStopSec=90s
WorkingDirectory=/home/whispernode/panic_cosmos/
ExecStart=/usr/local/bin/pipenv run python /home/whispernode/panic_cosmos/run_alerter.py

[Install]
WantedBy=multi-user.target
```

Lastly, we will *enable* and *start* the alerter service:

```shell
sudo systemctl enable panic_alerter.service
sudo systemctl start panic_alerter.service
```

Check out `systemctl status` or the logs in `<ALERTER_DIR>/logs/` to confirm that the alerter is running. Alternatively, if you set up Telegram, try interacting with the Telegram bot (using `/help`).
